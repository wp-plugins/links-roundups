var LR=LR||{};!function(){var a=jQuery;"undefined"==typeof LR.instances&&(LR.instances={}),LR.CreateCampaignModal=LR.Modal.extend({actions:{Yes:"createCampaign",Cancel:"close"},initialize:function(a){return this.content="Are you sure you want to create a new MailChimp campaign?",LR.Modal.prototype.initialize.apply(this,arguments)},createCampaign:function(){if("undefined"!=typeof this.ongoing&&-1==a.inArray(this.ongoing.state(),["resolved","rejected"]))return!1;var c=this,d={url:ajaxurl,dataType:"json",method:"post",success:function(a){if(c.hideSpinner(),c.close(),a.success){var d=new Backbone.Model(a.data);LR.instances.campaignSuccessModal=new LR.CampaignCreatedModal({model:d}),LR.instances.campaignSuccessModal.render(),b(d)}else new LR.Modal({className:"lroundups-error-modal",content:"Failed to create MailChimp Campaign. Error message:<br /><strong>"+a.message+"</strong>",actions:{Close:"close"}}).render()},error:function(){c.hideSpinner(),c.close(),new LR.Modal({className:"lroundups-error-modal",content:"Something went wrong. Please try again.",actions:{Close:"close"}}).render()}},e={action:"lroundups_create_mailchimp_campaign",security:LR.ajax_nonce,post_id:LR.post_id};return d.data=e,this.showSpinner(),this.ongoing=a.ajax(d),!1}}),LR.CampaignCreatedModal=LR.Modal.extend({actions:{Close:"close"},initialize:function(a){var b=a.model;return this.content='New MailChimp campaign created successfully!<br /><a target="blank" href="https://'+LR.mc_api_endpoint+".admin.mailchimp.com/campaigns/wizard/confirm?id="+b.get("web_id")+'">Click here to edit your campaign in MailChimp.</a>',LR.Modal.prototype.initialize.apply(this,arguments)}});var b=function(b){var c='<p>A MailChimp roundup campaign exists for this post.</p><a class="button" target="blank" href="https://'+LR.mc_api_endpoint+".admin.mailchimp.com/campaigns/wizard/confirm?id="+b.get("web_id")+'">Edit in MailChimp.</a>',d=a("#link-roundups-create-mailchimp-campaign"),e=d.parent();d.remove(),e.html(c)};a(document).ready(function(){a("#link-roundups-create-mailchimp-campaign").click(function(){return"undefined"==typeof a(this).attr("disabled")&&("undefined"==typeof LR.instances.campaignModal&&(LR.instances.campaignModal=new LR.CreateCampaignModal),LR.instances.campaignModal.render()),!1})})}();